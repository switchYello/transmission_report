# transmission_report辅种情况分析脚本

## 1、功能介绍

> 2024-10-30 新建:  
1、脚本会调用transmission的接口，获取当前所有种子，按照文件名称大小进行分组，以表格形式展示    
2、从输出能够看出每个种子在每个站点的做种情况，可以辅助决策删种，执行脚本后在控制台中输出如下效果  

> 2024-10-31 更新：  
1、新增官种视图，已站点维度展示官种分布和辅种分布
2、支持站点多track合并，类似麒麟这种存在两个track（hdkyl、hdkylin）合并成一个，统计时只统计一份
3、明细试图中，会在站点后面标注这个文件在当前网站上是否是官种
---- 

```shell
user@debian:/opt/transmission_report/src$ bash start.sh -utr -ptr -c10
┌──────┬────────────────────────────────────────────────────────────────────────────────────────────────┬──────────┬───────────┬────────────────────────────────────┐
│ 序号 │                                              文件名                                              │  辅种数量 │   文件大小  │  站点名称(最后活跃时间)                           │
├──────┼────────────────────────────────────────────────────────────────────────────────────────────────┼──────────┼───────────┼────────────────────────────────────┤
│  0   │                 脱口秀大会.Rock.&.Roast.S06.2024.2160p.WEB-DL.H265.DDP2.0-ADWeb                  │     2    │  56.23 GB │ hdkylin (2024-10-28 17:59:25)      │
│      │                                                                                                │          │           │ m-team (2024-10-29 15:10:47)       │
└──────┴────────────────────────────────────────────────────────────────────────────────────────────────┴──────────┴───────────┴────────────────────────────────────┘
│  1   │  边水往事.Escape.from.the.Trilateral.Slopes.S01.2024.1080p.WEB-DL.HEVC.10bit.HDR.AAC.2.0-HDKWeb  │     3    │  48.82 GB │ hdkyl (2024-10-29 14:02:59)       │
│      │                                                                                                │          │           │ hdkylin (2024-10-29 14:02:59)      │
│      │                                                                                                │          │           │ m-team (1970-01-01 08:00:00)       │
└──────┴────────────────────────────────────────────────────────────────────────────────────────────────┴──────────┴───────────┴────────────────────────────────────┘
│  2   │     异形前传：普罗米修斯 Prometheus 2012 UHD Blu-ray 2160p HDR HEVC DTS-HD MA 7.1-Pete@HDSky       │    4     │  47.62 GB │ cyanbug (2024-10-28 21:40:31)      │
│      │                                                                                                │          │           │ hdkyl (2024-10-29 20:59:35)        │
│      │                                                                                                │          │           │ hdkylin (2024-10-29 20:59:35)      │
│      │                                                                                                │          │           │ m-team (2024-10-28 12:46:15)       │
└──────┴────────────────────────────────────────────────────────────────────────────────────────────────┴──────────┴───────────┴────────────────────────────────────┘
│  3   │                American.Horror.Story.S01.2011.Disney+.WEB-DL.1080p.H264.DDP-HDCTV              │    2     │  31.95 GB │ cyanbug (2024-10-25 11:54:16)      │
│      │                                                                                                │          │           │ m-team (2024-10-26 17:20:22)       │
└──────┴────────────────────────────────────────────────────────────────────────────────────────────────┴──────────┴───────────┴────────────────────────────────────┘
│  4   │             Gambling.Apocalypse.Kaiji.S02.2011.1080p.BluRay.x265.10bit.FLAC.2.0-ADE            │    2     │  29.68 GB │ cyanbug (1970-01-01 08:00:00)      │
│      │                                                                                                │          │           │ hdkylin (1970-01-01 08:00:00)      │
└──────┴────────────────────────────────────────────────────────────────────────────────────────────────┴──────────┴───────────┴────────────────────────────────────┘
│  5   │             Gambling.Apocalypse.Kaiji.S01.2007.1080p.BluRay.x265.10bit.FLAC.2.0-ADE            │    2     │  27.07 GB │ cyanbug (1970-01-01 08:00:00)      │
│      │                                                                                                │          │           │ hdkylin (1970-01-01 08:00:00)      │
└──────┴────────────────────────────────────────────────────────────────────────────────────────────────┴──────────┴───────────┴────────────────────────────────────┘
│  6   │                 胆小鬼.Nobody.Knows.S01.2022.1080p.NowPlay.WEB-DL.H264.AAC-HHWEB                │    4     │  26.83 GB │ cyanbug (2024-10-21 12:23:59)      │
│      │                                                                                                │          │           │ hdkyl (2024-10-25 16:41:19)        │
│      │                                                                                                │          │           │ hdkylin (2024-10-25 16:41:19)      │
│      │                                                                                                │          │           │ m-team (2024-10-28 15:51:15)       │
└──────┴────────────────────────────────────────────────────────────────────────────────────────────────┴──────────┴───────────┴────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                     辅种视图,去重种子总数:316 实际磁盘占用:821.13 GB                                           │
├──────┬──────────────┬────────┬──────────┬──────────┬────────────┬──────────┬────────────┬────────┬────────────┬──────────┤
│ 序号  │     站点      │ 官种数  │ 官种大小  │ 非官种数   │ 非官种大小  │ 做种总数   │ 做种总大小   │ 辅种数  │ 辅种总大小   │ 辅种比例  │
├──────┼──────────────┼────────┼──────────┼──────────┼────────────┼──────────┼────────────┼────────┼────────────┼──────────┤
│  1   │    m-team    │   8    │ 26.13 GB │    96    │ 501.59 GB  │   104    │ 527.72 GB  │   77   │ 405.23 GB  │  76.79%  │
└──────┴──────────────┴────────┴──────────┴──────────┴────────────┴──────────┴────────────┴────────┴────────────┴──────────┘
│  2   │    hdkyl     │   10   │ 91.01 GB │   119    │ 376.89 GB  │   129    │ 467.90 GB  │   81   │ 381.05 GB  │  81.44%  │
└──────┴──────────────┴────────┴──────────┴──────────┴────────────┴──────────┴────────────┴────────┴────────────┴──────────┘
│  3   │   cyanbug    │   0    │  0.00 B  │   104    │ 269.55 GB  │   104    │ 269.55 GB  │   68   │ 267.40 GB  │  99.20%  │
└──────┴──────────────┴────────┴──────────┴──────────┴────────────┴──────────┴────────────┴────────┴────────────┴──────────┘
│  4   │    kufei     │   0    │  0.00 B  │    30    │ 100.39 GB  │    30    │ 100.39 GB  │   1    │  8.18 GB   │  8.15%   │
└──────┴──────────────┴────────┴──────────┴──────────┴────────────┴──────────┴────────────┴────────┴────────────┴──────────┘
│  5   │  dns-verify  │   0    │  0.00 B  │    49    │  31.22 GB  │    49    │  31.22 GB  │   0    │   0.00 B   │  0.00%   │
└──────┴──────────────┴────────┴──────────┴──────────┴────────────┴──────────┴────────────┴────────┴────────────┴──────────┘
│  6   │ ilovelemonhd │   3    │ 23.96 GB │    12    │  4.17 GB   │    15    │  28.13 GB  │   0    │   0.00 B   │  0.00%   │
└──────┴──────────────┴────────┴──────────┴──────────┴────────────┴──────────┴────────────┴────────┴────────────┴──────────┘
│  7   │   connects   │   0    │  0.00 B  │    7     │  21.47 GB  │    7     │  21.47 GB  │   0    │   0.00 B   │  0.00%   │
└──────┴──────────────┴────────┴──────────┴──────────┴────────────┴──────────┴────────────┴────────┴────────────┴──────────┘


```



## 2、安装
> **脚本需要python环境，依赖python的venv组件，如果安装时缺少相关依赖请自行安装好。**

1. 将本项目从github下载到服务器上,放在某个文件夹下
```shell
git clone https://github.com/switchYello/transmission_report.git
```

2. 执行如下命令初始化python venv环境
```shell
#进入src目录
cd src
#创建venv环，此时会创建一个隐藏文件夹.venv
python3 -m venv .venv
#激活venv环境
source .venv/bin/activate
#venv环境下安装必要的组件
python3 -m pip install -r requirements.txt
#退出虚拟环境
deactivate
#加执行权限
chmod u+x start.sh
```

3. 如果后续有更新的话使用git重新拉代码
```shell
git pull -f https://github.com/switchYello/transmission_report.git
```


## 3、使用
使用时进入到脚本所在的文件夹下，直接执行 `bash start.sh` 即可使用默认参数运行一次，控制台可输出上述报表。

参数：
```text
-h 指定tr地址,需要带前面的http，默认http://127.0.0.1:9091
-u 指定用户名 默认空字符串
-p 指定密码 默认空字符串
-m 小于该大小的种子不显示,单位为MB 默认0全部展示
-c 列表展示前多少个种子 默认500
-t 想要搜索的trade，比如只看包含馒头的可以添加参数 -t team，就会过滤出包含馒头的种子
```


示例:  
```text
1、搜索馒头的辅种情况，即track中包含team字符的，账号密码都是tr
bash start.sh -hhttp://127.0.0.1:9091 -utr -ptr -t team

2、展示大于500MB的，从大到小排序的前50个种子，账号密码都是tr
bash start.sh -h http://127.0.0.1:9091 -utr -ptr -m500 -c 50

3、搜索大青虫前100个种子
bash start.sh -h http://127.0.0.1:9091 -utr -ptr -c 100 -t bug 
```
如果参数和默认值一样可以省略不写，可通过定义alias将参数写好，这样就不用每次输入路径和账号密码了



## 4、卸载
因为使用的venv环境，直接将git对应的文件夹全部删除即可。  



## 5、小技巧，使用别名配置默认值
```text
在用户目录下的隐藏文件.baserc文件中增加如下行（参数和路径自行修改）
cd ~
vi .bashrc
alias reporttr='bash /path_to_source/src/start.sh -utr -ptr -c200'
保存后执行 `source .baserc`或者退出ssh重新连接


上面的意思是为引号内的这行脚本定义一个别名，并且会在启动时初始化到环境变量里。
后面无论在哪个目录下，像下面这样直接执行`reporttr`都能调用脚本了,而且可以添加参数覆盖别名中的参数
user@debian:/opt/docker$ reporttr  -c 50
```

